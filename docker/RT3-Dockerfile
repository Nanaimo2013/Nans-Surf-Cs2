FROM        registry.gitlab.steamos.cloud/steamrt/sniper/platform:latest-container-runtime-depot
LABEL       author="Nans" maintainer="nans@nookure.com"
LABEL       org.opencontainers.image.description="SteamRT3 Nans Platform image for CS2 Surf servers with fixes"
LABEL       org.opencontainers.image.source="https://github.com/nookure/cs2-surf"

# Prep OS
RUN         mkdir -p /etc/sudoers.d && \
            echo "%sudo ALL=(ALL:ALL) NOPASSWD: ALL" > /etc/sudoers.d/flatdeb && \
            chmod 0440 /etc/sudoers.d/flatdeb

ENV         DEBIAN_FRONTEND=noninteractive
RUN         apt update && \
            apt install -y iproute2 curl tar procps \
            lib32gcc1 \
            lib32stdc++6 \
            lib32ncurses6 \
            libcurl4-openssl-dev && \
            apt-get clean

# Create container user
RUN         useradd -m -d /home/container -s /bin/bash container && \
            mkdir -p /home/container/.steam/sdk32 && \
            mkdir -p /home/container/.steam/sdk64 && \
            chown -R container:container /home/container

USER        container
ENV         USER=container HOME=/home/container
WORKDIR     /home/container

# Copy entrypoint script
COPY        ./docker/entrypoint.sh /entrypoint.sh
RUN         chmod +x /entrypoint.sh

CMD         [ "/bin/bash", "/entrypoint.sh" ]
