FROM        registry.gitlab.steamos.cloud/steamrt/sniper/platform:latest-container-runtime-depot
LABEL       author="Nans" maintainer="jmfcorp@jmfhosting.com"
LABEL       org.opencontainers.image.description="SteamRT3 Nans Platform image for CS2 Surf servers with fixes"
LABEL       org.opencontainers.image.source="https://github.com/nanaimo2013/Nans-Surf-Cs2"

# Prep OS
RUN         mkdir -p /etc/sudoers.d && \
            echo "%sudo ALL=(ALL:ALL) NOPASSWD: ALL" > /etc/sudoers.d/flatdeb && \
            chmod 0440 /etc/sudoers.d/flatdeb

ENV         DEBIAN_FRONTEND=noninteractive
RUN         apt update && \
            apt install -y iproute2 curl tar procps \
            lib32gcc1 \
            lib32stdc++6 \
            lib32ncurses6 \
            libcurl4-openssl-dev \
            libssl-dev \
            libsdl2-2.0-0 \
            libnm0 \
            ca-certificates \
            locales \
            tzdata \
            net-tools \
            iputils-ping \
            netcat \
            iptables \
            gcc \
            build-essential && \
            apt-get clean

# Set up locales
RUN         locale-gen en_US.UTF-8
ENV         LANG=en_US.UTF-8 \
            LANGUAGE=en_US:en \
            LC_ALL=en_US.UTF-8

# Create container user
RUN         useradd -m -d /home/container -s /bin/bash container && \
            mkdir -p /home/container/.steam/sdk32 && \
            mkdir -p /home/container/.steam/sdk64 && \
            chown -R container:container /home/container

USER        container
ENV         USER=container HOME=/home/container
WORKDIR     /home/container

# Copy entrypoint script and make it executable
COPY        --chown=container:container ./docker/entrypoint.sh /entrypoint.sh
RUN         chmod +x /entrypoint.sh

CMD         [ "/bin/bash", "/entrypoint.sh" ]
